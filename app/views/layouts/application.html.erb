<!DOCTYPE html>
<html>

  <head>

    <title><%= title %></title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <%= csrf_meta_tag %>
    <%= render 'layouts/stylesheets' %>
    <%= javascript_include_tag 'jquery.js' %>
    <%= javascript_include_tag 'jquery-ui-1.8.17.custom.min.js' %>
    <%= javascript_include_tag 'application.js' %>
    <%= javascript_include_tag 'jquery.idletimer.js' %>
    <%= javascript_include_tag 'jquery.idletimeout.js' %>
    <%= javascript_include_tag 'bootstrap-twipsy.js' %>
    <%= javascript_include_tag 'bootstrap-popover.js' %>

    <script type="text/javascript">
      // load the my-script-file.js and display an alert dialog once the script has been loaded
      loadScript('/javascripts/bootstrap-dropdown.js');
      loadScript('/javascripts/bootstrap-alerts.js');
      loadScript('/javascripts/bootstrap-modal.js');
      
    </script>
    <!-- Security Update-->
    <%= javascript_tag "var AUTH_TOKEN = #{form_authenticity_token.inspect};" if protect_against_forgery? %>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="apple-touch-icon" href="/images/ucsf_ipad_logo.png"/>
    <link rel="apple-touch-startup-image" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)" href="/images/ucsf_startup_logo_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)" href="/images/ucsf_startup_logo_portrait.png">

  </head>

  <body style="padding-top: 40px;" >

    <%= render 'layouts/header' %>

    <div id="appContainer">
      
      <div class="container">

        <div class="row">

          <div class="span16">
            <div id="idletimeout" class="alert-message">
              You will be logged off in <span><!-- countdown place holder --></span>&nbsp;seconds due to inactivity. 
              <a id="idletimeout-resume" href="#">Click here to continue using this web page</a>.
            </div>

            <% flash.each do |key, value| %>
            <div class="alert-message <%= key %> info"><%= value.html_safe %></div>
            
            <% end %>

            <div class="alert-message warning fade in" data-alert="alert">
              <a class="close" href="#">Ã—</a>
              <p><strong>Warning :</strong> This is a UCSF Medical Center computer system which may be accessed and used only by authorized personnel. All data in this system is confidential.  System actions are logged, and system use is for business purposes only. Unauthorized access and use of this system may subject violators to criminal, civil, and/or administrative actions.</p>
            </div>
                      
            <%= yield %>

            <%= render 'layouts/footer' %>

          </div>

        </div>

      </div>

    </div>

    <script type="text/javascript">

      if(<%= signed_in? %>){

        var j$ = jQuery.noConflict();
        var autosaveOn = false;
        var idleTime = new Date();
        var refreshIntervalId;
        var timeout = <%= ENV['app_timeout'] %>;
        
        if ( j$('#idletimeout')[0] || j$('#idletimeout a')[0] ) { 
        j$.idleTimeout('#idletimeout', '#idletimeout a', {
          idleAfter: timeout,
          pollingInterval: 60,
          //keepAliveURL: 'keepalive.php',
          //serverResponseEquals: 'OK',
          warningLength: 30,
          onTimeout: function(){
            j$(this).slideUp();
            window.location = "/signoutexp";
            //location.reload();
          },
          onIdle: function(){
            j$(this).slideDown(); // show the warning bar
          },
          onCountdown: function( counter ){
            j$(this).find("span").html( counter ); // update the counter
          },
          onResume: function(){
            j$(this).slideUp(); // hide the warning bar
          }
        });

      }

      }

      // For use within normal web clients 
      var isiPad = navigator.userAgent.match(/iPad/i) != null;

      // For use within iPad developer UIWebView
      // Thanks to Andrew Hedges!
      var ua = navigator.userAgent;
      var isiPad = /iPad/i.test(ua) || /iPhone OS 3_1_2/i.test(ua) || /iPhone OS 3_2_2/i.test(ua);

      if (isiPad) {
        var a = document.getElementsByTagName("a");
        for(var i=0;i<a.length;i++)
        {
            a[i].onclick=function()
            {
                if(this.getAttribute("href")) 
                  window.location=this.getAttribute("href");
                return false
            }
        }
      }
    </script>
  </body>

</html>